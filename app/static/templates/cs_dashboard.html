<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Dashboard - LMS</title>
    <link rel="stylesheet" href="/app/static/css/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* ƒê·ªãnh h√¨nh chung cho c√°c select, input, textarea trong form-box v√† form-grid */
        .form-control, 
        .form-box select, 
        .form-box input[type="text"], 
        .form-box textarea,
        /* √Åp d·ª•ng cho khu v·ª±c Ghi nh·∫≠n Ph·∫£n h·ªìi (Filter) */
        #record-feedback select,
        #record-feedback input[type="text"],
        /* √ÅP D·ª§NG CHO KHU V·ª∞C T·∫†O TICKET */
        #ticket-management select,
        #ticket-management input[type="text"],
        #ticket-management textarea {
            /* ƒê·ªãnh h√¨nh container */
            padding: 8px 12px;
            height: 40px; 
            border: 1px solid #d1d5db; /* gray-300 */
            border-radius: 6px; 
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* shadow-sm nh·∫π */
            width: 100%; 
            box-sizing: border-box; 
            
            /* Typography */
            background-color: #ffffff;
            color: #1f2937; /* gray-800 */
            font-size: 14px;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        /* ƒê·ªãnh h√¨nh cho textarea */
        .form-box textarea.form-control {
            height: auto;
            min-height: 100px; 
            resize: vertical; /* Cho ph√©p k√©o d√£n theo chi·ªÅu d·ªçc */
        }

        /* Hi·ªáu ·ª©ng Focus */
        .form-control:focus, 
        .form-box select:focus, 
        .form-box input:focus,
        .form-box textarea:focus,
        /* √ÅP D·ª§NG CHO KHU V·ª∞C T·∫†O TICKET */
        #ticket-management select:focus,
        #ticket-management input:focus,
        #ticket-management textarea:focus {
            border-color: #4A6CF7; /* Blue ch·ªß ƒë·∫°o */
            box-shadow: 0 0 0 2px rgba(74, 108, 247, 0.3);
            outline: none;
        }

        /* T·∫°o style ƒë·∫πp cho select (th√™m m≈©i t√™n t√πy ch·ªânh) */
        .form-box select, #record-feedback select,
        /* √ÅP D·ª§NG CHO KHU V·ª∞C T·∫†O TICKET */
        #ticket-management select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M7 10l5 5 5-5H7z' fill='%236B7280'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 14px;
            padding-right: 30px; 
            cursor: pointer;
        }
        
        /* C·∫•u tr√∫c grid cho form t·∫°o ticket v√† filter */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        /* CƒÉn ch·ªânh c√°c n√∫t tab trong khu v·ª±c Qu·∫£n l√Ω H·ªçc vi√™n */
        #student-management .button-group {
            flex-wrap: wrap;
            gap: 10px;
        }

.body-scroll-lock {
    overflow: hidden !important;
}
/* ===================================== */
/* CSS T√ôY CH·ªàNH CHO B·∫¢NG TICKET V√Ä PH·∫¢N H·ªíI */
/* ===================================== */

#ticket-list-table th,
#feedback-history-table th {
    font-size: 0.9rem;
    font-weight: 600;
    color: #4b5563; /* gray-600 */
    text-transform: uppercase;
    padding: 12px 15px;
    border-bottom: 2px solid #e5e7eb; /* gray-200 */
}

#ticket-list-table td,
#feedback-history-table td {
    padding: 10px 15px; /* Gi·∫£m padding */
    font-size: 0.9rem; /* Font ch·ªØ nh·ªè h∆°n */
    color: #374151; /* gray-700 */
    border-bottom: none; /* Lo·∫°i b·ªè ƒë∆∞·ªùng vi·ªÅn d∆∞·ªõi */
    vertical-align: middle;
    font-weight: 400; 
}

#ticket-list-table tbody tr,
#feedback-history-table tbody tr {
    border-bottom: 1px solid #f3f4f6; /* gray-100 nh·∫π */
    transition: background-color 0.15s ease;
}

#ticket-list-table tbody tr:last-child {
    border-bottom: none;
}

#ticket-list-table tbody tr:hover,
#feedback-history-table tbody tr:hover {
    background-color: #f9fafb; /* gray-50 khi hover */
}

#ticket-list-table .status,
#feedback-history-table .status {
    display: inline-block;
    padding: 4px 8px;
    font-size: 0.75rem;
    font-weight: 600;
    border-radius: 9999px;
}


/* ================================================= */
/* C·∫≠p nh·∫≠t Modal Chi ti·∫øt H·ªçc vi√™n (FIX R·ªòNG) */
/* ================================================= */

.modal-overlay.student-detail-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6);
    display: none; 
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-overlay.student-detail-modal.active {
    display: flex;
}

/* üéØ ƒêI·ªÄU CH·ªàNH K√çCH TH∆Ø·ªöC V√Ä CƒÇN GI·ªÆA MODAL */
.modal-content.student-detail-content {
    background: #fff;
    padding: 30px;
    border-radius: 8px;
    /* TƒÉng chi·ªÅu r·ªông l√™n */
    width: 80%;
    max-width: 900px; /* Gi·ªõi h·∫°n t·ªëi ƒëa */
    
    /* Thi·∫øt l·∫≠p chi·ªÅu cao t·ªëi ƒëa */
    max-height: 90vh; /* TƒÉng chi·ªÅu cao t·ªëi ƒëa */
    overflow-y: auto; /* Cho ph√©p cu·ªôn n·∫øu n·ªôi dung qu√° d√†i */
    
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    position: relative;
    
    /* C·∫•u tr√∫c flex ƒë·ªÉ n·ªôi dung b√™n trong t·ª± ƒëi·ªÅu ch·ªânh */
    display: flex;
    flex-direction: column;
}

.modal-body {
    padding: 15px 0 0 0; /* Gi·∫£m padding tr√™n d∆∞·ªõi ƒë·ªÉ t·ªëi ∆∞u di·ªán t√≠ch */
    flex-grow: 1;
}

.modal-header {
    border-bottom: 1px solid #eee;
    padding-bottom: 15px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* üéØ C·∫§U TR√öC GRID CHO TH√îNG TIN C∆† B·∫¢N V√Ä L·ªöP H·ªåC */
.modal-header-info {
    display: grid;
    /* Chia l√†m 2 c·ªôt: 1 c·ªôt cho info c∆° b·∫£n, 1 c·ªôt cho danh s√°ch l·ªõp */
    grid-template-columns: 1fr 1.5fr; 
    gap: 20px;
    margin-bottom: 25px;
}

@media (max-width: 768px) {
    .modal-header-info {
        /* Chuy·ªÉn sang 1 c·ªôt tr√™n m√†n h√¨nh nh·ªè */
        grid-template-columns: 1fr;
    }
}


.detail-section {
    margin-bottom: 25px;
    padding: 15px;
    border-radius: 4px;
    background-color: #f8fafc;
}

.detail-section h4 {
    color: #0f766e;
    border-bottom: 2px solid #e0f2f1;
    padding-bottom: 5px;
    margin-bottom: 10px;
}

.detail-list p {
    margin: 3px 0;
    font-size: 0.95rem;
}

/* ===================================== */
/* CSS cho Chart m√¥ ph·ªèng */
/* ===================================== */

.performance-chart-container {
    padding-top: 15px;
}

.chart-bar-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 0.85rem;
}

.chart-bar-label {
    width: 120px;
    font-weight: 600;
    color: #333;
}

.chart-bar-wrapper {
    flex-grow: 1;
    height: 20px;
    background-color: #eee;
    border-radius: 4px;
    overflow: hidden;
    position: relative;
}

.chart-bar {
    height: 100%;
    background-color: #1e40af; 
    transition: width 0.5s ease-out;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 5px;
}

.chart-bar-value {
    color: white;
    font-weight: bold;
    font-size: 0.75rem;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.4);
}
</style>
</head>
<body>
    <div class="dashboard-container">
        <div id="sidebar-placeholder"></div>
        <main class="main-content">
            <div id="header-placeholder"></div>
            <div class="content-area">
                <section id="dashboard" class="content-section active">
                    <h2>T·ªïng quan CS</h2>
                    <div class="card-container" style="margin-bottom: 30px;">
                        <div class="card">
                            <i class="fa-solid fa-users"></i>
                            <h3 id="total-students">0</h3>
                            <p>T·ªïng s·ªë h·ªçc vi√™n</p>
                        </div>
                        <!-- <div class="card">
                            <i class="fa-solid fa-comment-exclamation"></i>
                            <h3 id="pending-feedback">0</h3>
                            <p>Ph·∫£n h·ªìi c·∫ßn x·ª≠ l√Ω</p>
                        </div> -->
                        <div class="card">
                            <!-- <i class="fa-solid fa-ticket-simple"></i> -->
                             <i class="fa-solid fa-graduation-cap"></i>
                            <h3 id="new-tickets">0</h3>
                            <p>ƒêi·ªÉm trung b√¨nh HV</p>
                        </div>
                        <div class="card">
                            <i class="fa-solid fa-chart-line"></i>
                            <h3 id="avg-attendance">0%</h3>
                            <p>T·ªâ l·ªá ƒëi·ªÉm danh TB</p>
                        </div>
                    </div>
                    
                    <div id="announcements-view" class="content-only-section active" style="margin-top: 20px;">
                        <h3 style="margin-bottom: 20px;"><i class="fas fa-bullhorn"></i> Th√¥ng b√°o m·ªõi nh·∫•t t·ª´ Ban Qu·∫£n l√Ω</h3>
                        <div id="announcements-list">
                            </div>
                    </div>
                </section>
                
                <section id="student-management" class="content-section">
                    <h2>Qu·∫£n l√Ω h·ªçc vi√™n</h2>

                    <div class="button-group" style="margin-bottom: 20px;">
                        <button class="btn btn-primary" data-target-tab="update-student"><i class="fa-solid fa-user-pen"></i> C·∫≠p nh·∫≠t h·ªçc vi√™n</button>
                        <button id="add-student-btn" class="btn btn-primary" data-target-tab="update-student"><i class="fa-solid fa-user-plus"></i> T·∫°o t√†i kho·∫£n h·ªçc vi√™n</button>
                    </div>

                    <div id="update-student" class="student-tab-content active">
                        <div class="table-container">
                            <h3>Danh s√°ch h·ªçc vi√™n</h3>
                            <table id="student-list-table">
                                <thead>
                                    <tr>
                                        <th>M√£ HV</th>
                                        <th>H·ªç t√™n</th>
                                        <th>L·ªõp</th>
                                        <th>ƒêi·ªÉm danh</th>
                                        <th>ƒêi·ªÉm trung b√¨nh</th>
                                        <th>H√†nh ƒë·ªông</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="monitor-attendance" class="student-tab-content hidden">
                        <div class="table-container">
                            <h3>B·∫£ng theo d√µi ƒêi·ªÉm danh m·∫´u</h3>
                            <table id="attendance-table">
                                <thead>
                                    <tr>
                                        <th>M√£ HV</th>
                                        <th>H·ªç t√™n</th>
                                        <th>L·ªõp</th>
                                        <th>T·ªïng bu·ªïi</th>
                                        <th>Bu·ªïi v·∫Øng</th>
                                        <th>T·ª∑ l·ªá (%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="monitor-performance" class="student-tab-content hidden">
                        <div class="table-container">
                            <h3>B·∫£ng theo d√µi K·∫øt qu·∫£ h·ªçc t·∫≠p m·∫´u</h3>
                            <table id="performance-table">
                                <thead>
                                    <tr>
                                        <th>M√£ HV</th>
                                        <th>H·ªç t√™n</th>
                                        <th>M√¥n h·ªçc</th>
                                        <th>ƒêi·ªÉm KT1</th>
                                        <th>ƒêi·ªÉm KT2</th>
                                        <th>ƒêi·ªÉm TB</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="record-feedback" class="content-section">
                    <h2>Ghi nh·∫≠n & Qu·∫£n l√Ω Ph·∫£n h·ªìi</h2>
                    
                    <div class="card" style="margin-bottom: 20px; padding: 20px;">
                        <h3>L·ªãch s·ª≠ Ph·∫£n h·ªìi ƒë√£ ghi nh·∫≠n</h3>
                        <div class="form-grid" style="grid-template-columns: 3fr 1fr; gap: 20px; margin-top: 15px;">
                            <div class="form-group">
                                <label for="feedback-search">T√¨m ki·∫øm (T√™n HV/L·ªõp):</label>
                                <input type="text" id="feedback-search" class="form-control" placeholder="T√¨m ki·∫øm theo M√£ ho·∫∑c t√™n...">
                            </div>

                            <div class="form-group">
                                <label for="feedback-sort-date">S·∫Øp x·∫øp theo Ng√†y:</label>
                                <select id="feedback-sort-date" class="form-control">
                                    <option value="newest">M·ªõi nh·∫•t</option>
                                    <option value="oldest">C≈© nh·∫•t</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table id="feedback-history-table">
                            <thead>
                                <tr>
                                    <th>H·ªç t√™n HV</th>
                                    <th>Ti√™u ƒë·ªÅx    </th>
                                    <th>Lo·∫°i</th>
                                    <th>N·ªôi dung (T√≥m t·∫Øt)</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y ghi nh·∫≠n</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </section>
                
                <section id="ticket-management" class="content-section">
                    <h2>Ticket c·ªßa t√¥i</h2>
                    
                    <h3>T·∫°o Ticket M·ªõi <i class="fa-solid fa-paper-plane"></i>
                    <div class="form-box card">
                        <div class="form-group">
                            <label for="ticket-title">Ti√™u ƒë·ªÅ Ticket:</label>
                            <input type="text" id="ticket-title" class="form-control" placeholder="Nh·∫≠p ti√™u ƒë·ªÅ t√≥m t·∫Øt...">
                        </div>

                        <div class="form-group">
                            <label for="ticket-description">N·ªôi dung chi ti·∫øt:</label>
                            <textarea id="ticket-description" rows="4" class="form-control" placeholder="M√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ..."></textarea>
                        </div>

                        <button id="submit-ticket-btn" class="btn btn-primary"> G·ª≠i Ticket</button>
                    </div>

                    <div class="table-container" style="margin-top: 30px;">
                        <h3>Danh s√°ch Ticket ƒëang ch·ªù x·ª≠ l√Ω</h3>
                        <table id="ticket-list-table">
                            <thead>
                                <tr>
                                    <th>Ti√™u ƒë·ªÅ</th>
                                    <th>N·ªôi dung</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y t·∫°o</th>
                                </tr>
                            </thead>
                            <tbody>
                                </tbody>
                        </table>
                    </div>
                </section>
                
            </div>
        </main>
    </div>

    <div id="profile-modal-overlay" class="modal-overlay hidden">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 id="profile-modal-title">Th√¥ng tin T√†i kho·∫£n</h3>
                <span id="close-profile-modal-btn" class="close-modal">&times;</span>
            </div>
            <div class="modal-body">
                
                <div id="profile-info-display">
                    <p><strong>T√™n ƒëƒÉng nh·∫≠p:</strong> <span id="profile-username"></span></p>
                    <p><strong>Email:</strong> <span id="profile-email"></span></p>
                </div>
                
                <div id="profile-edit-form" class="hidden">
                    <div class="form-group">
                        <label for="edit-username">T√™n ƒëƒÉng nh·∫≠p m·ªõi:</label>
                        <input type="text" id="edit-username" class="form-control" disabled> 
                    </div>
                    <div class="form-group">
                        <label for="edit-email">Email:</label>
                        <input type="email" id="edit-email" class="form-control" disabled readonly>
                    </div>
                    
                    <hr style="margin: 20px 0;">
                    
                    <div class="form-group">
                        <label for="new-password">M·∫≠t kh·∫©u m·ªõi:</label>
                        <input type="password" id="new-password" class="form-control" placeholder="ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng mu·ªën ƒë·ªïi m·∫≠t kh·∫©u">
                    </div>
                    <div class="form-group">
                        <label for="current-password">M·∫≠t kh·∫©u hi·ªán t·∫°i (B·∫ÆT BU·ªòC ƒë·ªÉ l∆∞u thay ƒë·ªïi):</label>
                        <input type="password" id="current-password" class="form-control" placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i" required>
                    </div>
                    <p class="text-danger hidden" id="password-error" style="color: red; font-size: 0.9em;">M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-profile-btn" class="btn btn-secondary">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <div id="add-student-modal-overlay" class="modal-overlay hidden">
        <div class="modal" style="max-width: 550px;">
            <div class="modal-header" style="width: 100%;">
                <h3 id="add-student-modal-title">T·∫°o T√†i kho·∫£n H·ªçc vi√™n m·ªõi</h3>
                <span id="close-add-student-modal-btn" class="close-modal">&times;</span>
            </div>
            <div class="modal-body" style="padding: 10px 20px;">
                <form id="add-student-form">
                    <div class="form-group">
                        <label for="new-student-fullname">H·ªç v√† t√™n H·ªçc vi√™n:</label>
                        <input type="text" id="new-student-fullname" name="fullName" class="form-control" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A" required>
                    </div>

                    <div class="form-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label for="new-student-username">T√™n ƒëƒÉng nh·∫≠p (Username):</label>
                            <input type="text" id="new-student-username" name="username" class="form-control" placeholder="V√≠ d·ª•: nvana01" required>
                        </div>
                        <div class="form-group">
                            <label for="new-student-password">M·∫≠t kh·∫©u ban ƒë·∫ßu:</label>
                            <input type="password" id="new-student-password" name="password" class="form-control" value="123456" required>
                            <small style="color: #6c757d;">(M·∫∑c ƒë·ªãnh l√† 123456)</small>
                        </div>
                    </div>
                
                    <div class="form-group">
                        <label for="new-student-email">Email:</label>
                        <input type="email" id="new-student-email" name="email" class="form-control" placeholder="example@email.com">
                    </div>

                    <div class="form-group">
                        <label for="new-student-class-id">M√£ L·ªõp ƒëƒÉng k√Ω (T√πy ch·ªçn):</label>
                        <input type="text" id="new-student-class-id" name="classId" class="form-control" placeholder="M√£ l·ªõp (V√≠ d·ª•: IT101)">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button id="cancel-add-student-btn" class="btn btn-secondary">H·ªßy</button>
                <button id="save-new-student-btn" type="submit" form="add-student-form" class="btn btn-primary"> T·∫°o t√†i kho·∫£n</button>
            </div>
        </div>
    </div>

<div class="modal-overlay student-detail-modal" id="student-detail-modal-overlay">
    <div class="modal-content student-detail-content">
        <div class="modal-header">
            <h3 id="detail-student-name">CHI TI·∫æT H·ªåC VI√äN</h3>
            <button class="close-btn" id="close-detail-modal-btn">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="modal-header-info">
                <div class="detail-section" style="margin-bottom: 0;">
                    <h4><i class="fas fa-info-circle"></i> Th√¥ng tin c∆° b·∫£n</h4>
                    <div class="detail-list">
                        <p><strong>M√£ HV:</strong> <span id="detail-student-id"></span></p>
                        <p><strong>Email:</strong> <span id="detail-student-email"></span></p>
                        <p><strong>Tr·∫°ng th√°i:</strong> <span id="detail-student-status"></span></p>
                    </div>
                </div>

                <div class="detail-section" style="margin-bottom: 0;">
                    <h4><i class="fas fa-chalkboard-teacher"></i> C√°c l·ªõp ƒëang theo h·ªçc</h4>
                    <ul id="detail-classes-list" style="padding-left: 20px; margin: 5px 0;">
                        </ul>
                </div>
            </div>
            <div class="detail-section">
                <h4><i class="fas fa-signal"></i> Hi·ªáu su·∫•t h·ªçc t·∫≠p t·ªïng quan</h4>
                <div class="detail-list" style="margin-bottom: 10px;">
                    <p><strong>ƒêi·ªÉm trung b√¨nh t·ªïng:</strong> <span id="detail-avg-score"></span></p>
                    <p><strong>S·ªë l∆∞·ª£ng b·∫£n ghi ƒëi·ªÉm:</strong> <span id="detail-records-count"></span></p>
                </div>
                
                <div class="performance-chart-container hidden" id="performance-chart-container">
                    </div>
            </div>

            <div id="class-specific-details-container" style="padding: 15px;">
                </div>
            </div>
    </div>
</div>
        <script src="/app/static/js/common.js"></script>
        <script src="/app/static/js/cs.js"></script>
    </body>
    </html>